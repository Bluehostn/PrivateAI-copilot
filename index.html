<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <title>Ù…Ù†Ø´Ø¦ Ø§Ù„Ù…ÙˆØ§Ù‚Ø¹ Ø§Ù„Ø°ÙƒÙŠ</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link href="styles.css" rel="stylesheet" />
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.rtl.min.css" rel="stylesheet" />
</head>
<body>
  <div class="container mt-5">
    <h2 class="text-center mb-4">ğŸš€ Ø£Ù†Ø´Ø¦ Ù…ÙˆÙ‚Ø¹Ùƒ Ø§Ù„Ø°ÙƒÙŠ Ø§Ù„Ø¢Ù†</h2>

    <div class="mb-3">
      <label class="form-label">Ø§Ø³Ù… Ø§Ù„Ù…ÙˆÙ‚Ø¹:</label>
      <input type="text" id="site-name" class="form-control" placeholder="Ù…Ø«Ù„Ø§Ù‹: Ù…ØªØ¬Ø± Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ" />
    </div>

    <div class="mb-3">
      <label class="form-label">ÙˆØµÙ Ø§Ù„Ù…ÙˆÙ‚Ø¹:</label>
      <textarea id="site-description" class="form-control" placeholder="Ø§ÙƒØªØ¨ ÙˆØµÙÙ‹Ø§ Ù„Ù„Ù…ÙˆÙ‚Ø¹ Ø§Ù„Ø°ÙŠ ØªØ±ÙŠØ¯ Ø¥Ù†Ø´Ø§Ø¡Ù‡..." rows="4"></textarea>
    </div>

    <button class="btn btn-success mb-3" onclick="generateSite()">Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ù…ÙˆÙ‚Ø¹</button>

    <div class="mb-3">
      <label class="form-label">Ø§Ù„ÙƒÙˆØ¯ Ø§Ù„Ù†Ø§ØªØ¬:</label>
      <textarea id="generated-code" class="form-control" readonly rows="10"></textarea>
    </div>

    <button class="btn btn-primary" onclick="previewSite()">Ù…Ø¹Ø§ÙŠÙ†Ø© Ø§Ù„Ù…ÙˆÙ‚Ø¹</button>
    <button class="btn btn-outline-secondary" onclick="copyCode()">Ù†Ø³Ø® Ø§Ù„ÙƒÙˆØ¯</button>
    <button class="btn btn-warning" onclick="saveToSupabase()">Ø­ÙØ¸ ÙÙŠ Supabase</button>

    <iframe id="site-preview" class="mt-4" style="width: 100%; height: 300px; border: 1px solid #ccc;"></iframe>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js"></script>
  <script src="supabase.js"></script>
  <script>
    const apiKey = "YOUR_OPENAI_API_KEY"; // Ø¶Ø¹ Ù…ÙØªØ§Ø­Ùƒ Ù‡Ù†Ø§

    async function generateSite() {
      const name = document.getElementById("site-name").value;
      const desc = document.getElementById("site-description").value;
      if (!name || !desc) return alert("ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ø³Ù… ÙˆÙˆØµÙ Ø§Ù„Ù…ÙˆÙ‚Ø¹");

      const prompt = `Ø£Ù†Ø´Ø¦ Ù„ÙŠ ÙƒÙˆØ¯ HTML ÙˆCSS Ù„Ù…ÙˆÙ‚Ø¹ Ø¨Ø¹Ù†ÙˆØ§Ù† "${name}"ØŒ ÙˆØµÙÙ‡: "${desc}". Ø§Ù„ØªØµÙ…ÙŠÙ… ÙŠØ¬Ø¨ Ø£Ù† ÙŠÙƒÙˆÙ† Ø£Ù†ÙŠÙ‚Ù‹Ø§ ÙˆØ¨Ø§Ù„Ù„ØºØ© Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©.`;

      const response = await fetch("https://api.openai.com/v1/chat/completions", {
        method: "POST",
        headers: {
          "Content-Type": "application/json",
          "Authorization": `Bearer ${apiKey}`
        },
        body: JSON.stringify({
          model: "gpt-4",
          messages: [{ role: "user", content: prompt }]
        })
      });

      const data = await response.json();
      const code = data.choices[0].message.content;
      document.getElementById("generated-code").value = code;
    }

    function previewSite() {
      const code = document.getElementById("generated-code").value;
      const iframe = document.getElementById("site-preview");
      const doc = iframe.contentDocument || iframe.contentWindow.document;
      doc.open();
      doc.write(code);
      doc.close();
    }

    function copyCode() {
      const code = document.getElementById("generated-code");
      code.select();
      document.execCommand("copy");
      alert("âœ… ØªÙ… Ù†Ø³Ø® Ø§Ù„ÙƒÙˆØ¯!");
    }

    async function saveToSupabase() {
      const name = document.getElementById("site-name").value;
      const description = document.getElementById("site-description").value;
      const html = document.getElementById("generated-code").value;

      const { data: { user } } = await supabase.auth.getUser();
      if (!user) return alert("âŒ ÙŠØ¬Ø¨ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø£ÙˆÙ„Ø§Ù‹");

      const response = await fetch("https://rlujwboirgabxqyvecvm.supabase.co/rest/v1/projects", {
        method: "POST",
        headers: {
          "Content-Type": "application/json",
          "apikey": supabaseKey,
          "Authorization": `Bearer ${supabaseKey}`,
          "Prefer": "return=representation"
        },
        body: JSON.stringify({
          name,
          description,
          html,
          user_id: user.id,
          created_at: new Date().toISOString()
        })
      });

      if (response.ok) {
        alert("âœ… ØªÙ… Ø­ÙØ¸ Ø§Ù„Ù…Ø´Ø±ÙˆØ¹ ÙÙŠ Supabase!");
      } else {
        alert("âŒ ÙØ´Ù„ Ø§Ù„Ø­ÙØ¸. ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª.");
      }
    }
  </script>
</body>
</html>
